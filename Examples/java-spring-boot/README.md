# Java Spring Boot example

Spring Boot is a popular framework for building Java-based web applications. By using the GSC tool,
you can deploy Spring Boot web applications inside a Gramine SGX enclave graminized containers.
For more information on Spring Boot, please visit https://spring.io/.

## Disclaimer

* This generated image is for non-production usage.

* Tested on:
  - Type: Azure Confidential Computing SGX Virtual Machine
  - OS: Linux (Ubuntu 20.04)
  - Size: Standard DC1s v3 (1 vCPU, 8 GiB memory)
  - OpenJDK 11
  - Gradle v7.6

## Software requirements

1. It is necessary to install the openjdk-11 package on your machine so that Gradle can
consume the files. Use the command below to install it:

```bash
$ sudo apt-get install openjdk-11-jdk
```

2. Follow the installation guide at https://gradle.org/install/ to install Gradle v7.6.

## Build and run graminized Docker image

1. Build a project using Gradle:

```bash
$ (cd spring-boot-web-service/; gradle build)
```

2. Build Docker image. Dockerfile copies the project jar file that was generated by Gradle
to build the image:

```bash
$ docker build -t openjdk-11-java-spring-boot .
```

3. Clean up files that will be no longer used:

```bash
$ (cd spring-boot-web-service/; gradle clean)
```

4. Navigate to the `gsc/` directory:

```bash
$ cd ../..
```

5. Graminize the Docker image (this step can take some time!):

```bash
$ ./gsc build openjdk-11-java-spring-boot Examples/java-spring-boot/java-spring-boot.manifest \
        -c <PATH-TO-CONFIG-FILE>
```

6. Sign the graminized Docker image:

```bash
$ ./gsc sign-image openjdk-11-java-spring-boot <PATH-TO-KEY-FILE> \
        -c <PATH-TO-CONFIG-FILE>
```

7. Run graminized image:

      * To run the image on the default port set to 8080,
   run the command (the application may take a while to load):

        ```bash
        $ docker run --rm --device=/dev/sgx_enclave \
                -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket \
                -p 8080:8080 \
                -d gsc-openjdk-11-java-spring-boot
        ```

      * To run the image on a customized port using an environment variable, i.e. 9080,
      run the following command (the application may take a while to load):

        ```bash
        $ docker run --rm --device=/dev/sgx_enclave \
                -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket \
                -e SERVER_PORT=9080 \
                -p 9080:9080 \
                -d gsc-openjdk-11-java-spring-boot
        ```

## Result

1. Once you have the graminized container up and running, verify its correctness by calling
the following command below. The result should be the following text - "Hello from Graminized Spring
Boot application".

```bash
$ wget -q localhost:<port>
$ cat index.html
```

2. To terminate the graminized container with Spring-Boot application, run the command:

```bash
$ docker stop <containerID>
```
